// Auto-generated XGBoost Event Predictor
// DO NOT EDIT - Generated by export_to_js.py

/**
 * Event Predictor Model (XGBoost exported to JavaScript)
 * Predicts event names from activity features
 */

export interface EventFeatures {
  distance_km: number;
  pace_min_per_km: number;
  elevation_gain: number;
  day_of_week: number;
  hour: number;
  month: number;
  contains_parkrun: number;
  contains_marathon: number;
  contains_half: number;
  contains_ultra: number;
  contains_fun_run: number;
  name_length: number;
  is_5k: number;
  is_10k: number;
  is_half_marathon: number;
  is_marathon: number;
  is_ultra: number;
  day_0?: number;
  day_1?: number;
  day_2?: number;
  day_3?: number;
  day_4?: number;
  day_5?: number;
  day_6?: number;
  hour_6?: number;
  hour_7?: number;
  hour_8?: number;
  hour_9?: number;
  hour_10?: number;
}

// Internal type with all features required (used by tree functions)
interface EventFeaturesComplete extends EventFeatures {
  day_0: number;
  day_1: number;
  day_2: number;
  day_3: number;
  day_4: number;
  day_5: number;
  day_6: number;
  hour_6: number;
  hour_7: number;
  hour_8: number;
  hour_9: number;
  hour_10: number;
}

export interface EventPrediction {
  event_name: string;
  probability: number;
  top_3: Array<{
    event_name: string;
    probability: number;
  }>;
  model: string;
}

const CLASS_NAMES = ["Bondi to Manly Ultra", "City2Surf", "Cooks River Fun Run", "Sydney 10", "Sydney Marathon", "rare_event"];

// Using 60 trees (out of 1200 total)

function tree0(features: EventFeaturesComplete): number { return (features['distance_km'] < 43.1894989 ? -0.0568676703 : 0.222488031); }
function tree1(features: EventFeaturesComplete): number { return (features['month'] < 8 ? -0.0545238517 : (features['distance_km'] < 15.658 ? (features['distance_km'] < 13.9549999 ? 0.0571466684 : 0.225921676) : -0.052012939)); }
function tree2(features: EventFeaturesComplete): number { return (features['hour_9'] < 0 ? -0.0566512719 : 0.190586999); }
function tree3(features: EventFeaturesComplete): number { return (features['month'] < 6 ? (features['elevation_gain'] < 93 ? 0.228962019 : -0.0344189517) : -0.0567394197); }
function tree4(features: EventFeaturesComplete): number { return (features['is_marathon'] < 1 ? -0.0570290573 : 0.200905919); }
function tree5(features: EventFeaturesComplete): number { return (features['month'] < 5 ? 0.167008713 : (features['hour'] < 8 ? (features['name_length'] < 7 ? (features['pace_min_per_km'] < 4.91837215 ? 0.0311036743 : -0.0038790442) : (features['elevation_gain'] < 185.699997 ? (features['pace_min_per_km'] < 4.67813206 ? -0.0402697064 : 0.0422388427) : -0.0475933664)) : (features['month'] < 9 ? (features['pace_min_per_km'] < 4.8811965 ? -0.0429136492 : 0.0124231866) : 0.155518398))); }
function tree6(features: EventFeaturesComplete): number { return (features['elevation_gain'] < 1569 ? -0.0562059581 : 0.200452209); }
function tree7(features: EventFeaturesComplete): number { return (features['elevation_gain'] < 185.699997 ? -0.0518786125 : (features['elevation_gain'] < 263.899994 ? 0.187167406 : -0.0512563065)); }
function tree8(features: EventFeaturesComplete): number { return (features['hour_9'] < 0 ? -0.0562583394 : 0.192267701); }
function tree9(features: EventFeaturesComplete): number { return (features['elevation_gain'] < 42 ? (features['hour_7'] < 0 ? -0.0422254018 : 0.189621076) : (features['distance_km'] < 9.99569988 ? 0.0939389393 : -0.0560501516)); }
function tree10(features: EventFeaturesComplete): number { return (features['distance_km'] < 40.9799004 ? -0.0556840673 : (features['pace_min_per_km'] < 5.82973766 ? 0.176022172 : -0.0487557948)); }
function tree11(features: EventFeaturesComplete): number { return (features['is_half_marathon'] < 1 ? (features['hour'] < 8 ? (features['month'] < 8 ? (features['elevation_gain'] < 42 ? -0.0440997481 : 0.07696376) : (features['distance_km'] < 20.927 ? (features['pace_min_per_km'] < 4.72596312 ? -0.0392109118 : 0.0125215743) : -0.0521494113)) : (features['elevation_gain'] < 47 ? -0.032472834 : 0.0842516571)) : 0.140949726); }
function tree12(features: EventFeaturesComplete): number { return (features['elevation_gain'] < 1569 ? -0.0554477088 : 0.157032743); }
function tree13(features: EventFeaturesComplete): number { return (features['distance_km'] < 15.658 ? (features['distance_km'] < 13.8983002 ? -0.0512499325 : 0.167878613) : -0.0521660931); }
function tree14(features: EventFeaturesComplete): number { return (features['hour_9'] < 0 ? -0.0554242209 : 0.162102446); }
function tree15(features: EventFeaturesComplete): number { return (features['month'] < 6 ? (features['month'] < 5 ? -0.0307843443 : 0.156880826) : -0.0550792329); }
function tree16(features: EventFeaturesComplete): number { return (features['is_marathon'] < 1 ? (features['hour_6'] < 0 ? -0.0543898232 : 0.0434524193) : 0.124718264); }
function tree17(features: EventFeaturesComplete): number { return (features['month'] < 5 ? 0.131457731 : (features['month'] < 10 ? (features['pace_min_per_km'] < 5.62300539 ? (features['hour_8'] < 0 ? (features['name_length'] < 7 ? 0.00942446105 : -0.0487026758) : 0.0258128084) : 0.0292856786) : (features['pace_min_per_km'] < 6.12343359 ? 0.142913043 : -0.0334831811))); }
function tree18(features: EventFeaturesComplete): number { return (features['distance_km'] < 78.2886963 ? -0.0550959371 : 0.137614593); }
function tree19(features: EventFeaturesComplete): number { return (features['distance_km'] < 15.658 ? (features['distance_km'] < 12.7784996 ? -0.0503200181 : 0.142661259) : -0.0523329638); }
function tree20(features: EventFeaturesComplete): number { return (features['distance_km'] < 9.92619991 ? 0.125359282 : -0.0549165308); }
function tree21(features: EventFeaturesComplete): number { return (features['month'] < 6 ? (features['month'] < 5 ? -0.0322487243 : 0.119167984) : -0.0543168448); }
function tree22(features: EventFeaturesComplete): number { return (features['is_marathon'] < 1 ? -0.0545002595 : (features['name_length'] < 6 ? 0.0332834683 : 0.129993752)); }
function tree23(features: EventFeaturesComplete): number { return (features['month'] < 5 ? 0.123542957 : (features['elevation_gain'] < 47 ? (features['pace_min_per_km'] < 4.67813206 ? -0.0499712713 : 3.37031706e-05) : (features['elevation_gain'] < 189.100006 ? (features['distance_km'] < 10.3240995 ? 0.0147375604 : 0.118545711) : (features['hour'] < 8 ? (features['hour_6'] < 0 ? -0.0433732979 : 0.0140127344) : 0.0435456969)))); }
function tree24(features: EventFeaturesComplete): number { return (features['distance_km'] < 78.2886963 ? -0.0538002215 : 0.130167887); }
function tree25(features: EventFeaturesComplete): number { return (features['distance_km'] < 15.658 ? (features['distance_km'] < 13.8983002 ? -0.0495975353 : 0.129794866) : -0.0521471165); }
function tree26(features: EventFeaturesComplete): number { return (features['hour_9'] < 0 ? -0.0541992374 : 0.132571965); }
function tree27(features: EventFeaturesComplete): number { return (features['month'] < 6 ? (features['elevation_gain'] < 93 ? 0.116298519 : -0.0305075999) : -0.0538263433); }
function tree28(features: EventFeaturesComplete): number { return (features['is_marathon'] < 1 ? (features['hour_6'] < 0 ? -0.0540377162 : 0.046830669) : (features['elevation_gain'] < 329 ? 0.0220991876 : (features['month'] < 9 ? 0.0344250277 : 0.123351924))); }
function tree29(features: EventFeaturesComplete): number { return (features['month'] < 5 ? 0.115854658 : (features['hour_8'] < 0 ? (features['name_length'] < 6 ? (features['elevation_gain'] < 240.800003 ? 0.0287540499 : -0.00280238921) : (features['day_of_week'] < 6 ? (features['distance_km'] < 78.6751022 ? 0.0339819007 : -0.0411395133) : (features['hour'] < 7 ? -0.0156629607 : -0.0458493493))) : 0.0639188737)); }
function tree30(features: EventFeaturesComplete): number { return (features['pace_min_per_km'] < 7.34726572 ? -0.0535805598 : 0.110466741); }
function tree31(features: EventFeaturesComplete): number { return (features['distance_km'] < 15.658 ? (features['distance_km'] < 13.8983002 ? -0.0484285988 : 0.12108963) : -0.050543081); }
function tree32(features: EventFeaturesComplete): number { return (features['hour_9'] < 0 ? -0.0531917587 : 0.12063583); }
function tree33(features: EventFeaturesComplete): number { return (features['month'] < 6 ? (features['elevation_gain'] < 93 ? 0.11613138 : -0.0308288671) : -0.0527036451); }
function tree34(features: EventFeaturesComplete): number { return (features['is_marathon'] < 1 ? -0.0533591025 : (features['hour_7'] < 0 ? 0.0428415798 : 0.109378949)); }
function tree35(features: EventFeaturesComplete): number { return (features['is_half_marathon'] < 1 ? (features['month'] < 5 ? 0.0925055966 : (features['month'] < 10 ? (features['name_length'] < 7 ? (features['elevation_gain'] < 234.399994 ? -0.0195535831 : 0.0159755144) : (features['month'] < 9 ? -0.0487746112 : -0.00787353422)) : (features['distance_km'] < 42.4804001 ? 0.109787785 : -0.0407869555))) : 0.112695925); }
function tree36(features: EventFeaturesComplete): number { return (features['distance_km'] < 78.2886963 ? -0.0529690795 : 0.106568031); }
function tree37(features: EventFeaturesComplete): number { return (features['distance_km'] < 14.1962996 ? (features['distance_km'] < 12.7784996 ? -0.0479844026 : 0.109055057) : -0.0490414724); }
function tree38(features: EventFeaturesComplete): number { return (features['hour_9'] < 0 ? -0.0525688827 : 0.105571069); }
function tree39(features: EventFeaturesComplete): number { return (features['month'] < 6 ? (features['pace_min_per_km'] < 4.27600765 ? 0.0637439564 : -0.0340058394) : -0.0530189462); }
function tree40(features: EventFeaturesComplete): number { return (features['distance_km'] < 40.9799004 ? -0.0523114391 : (features['hour_7'] < 0 ? 0.0443337075 : 0.107384063)); }
function tree41(features: EventFeaturesComplete): number { return (features['is_half_marathon'] < 1 ? (features['month'] < 5 ? 0.0841376036 : (features['month'] < 10 ? (features['contains_marathon'] < 1 ? (features['name_length'] < 7 ? (features['elevation_gain'] < 263.899994 ? -0.0285384245 : 0.0139793176) : -0.0488033667) : -0.000190509352) : (features['elevation_gain'] < 550 ? 0.0939818621 : -0.0393647105))) : 0.10389217); }
function tree42(features: EventFeaturesComplete): number { return (features['pace_min_per_km'] < 7.34726572 ? -0.0521795154 : 0.0976189598); }
function tree43(features: EventFeaturesComplete): number { return (features['month'] < 8 ? -0.0497776531 : (features['distance_km'] < 14.1962996 ? (features['distance_km'] < 13.9181995 ? 0.0167095121 : 0.0957294405) : -0.0480186231)); }
function tree44(features: EventFeaturesComplete): number { return (features['hour_9'] < 0 ? -0.0514970124 : 0.0960329026); }
function tree45(features: EventFeaturesComplete): number { return (features['month'] < 6 ? (features['month'] < 5 ? -0.0299643856 : 0.100548618) : -0.051142659); }
function tree46(features: EventFeaturesComplete): number { return (features['is_marathon'] < 1 ? -0.0517067015 : (features['elevation_gain'] < 279 ? 0.024286272 : (features['distance_km'] < 42.2975006 ? 0.0994775072 : 0.0264293831))); }
function tree47(features: EventFeaturesComplete): number { return (features['is_half_marathon'] < 1 ? (features['hour_6'] < 0 ? (features['hour_8'] < 0 ? (features['day_of_week'] < 6 ? (features['elevation_gain'] < 1606 ? 0.0217807796 : -0.0388096832) : (features['distance_km'] < 42.2877998 ? -0.0488484129 : -0.00613327418)) : (features['elevation_gain'] < 121 ? 0.0562150963 : -0.0207308382)) : (features['distance_km'] < 42.7798004 ? 0.0631495938 : -0.0201858412)) : 0.0984685645); }
function tree48(features: EventFeaturesComplete): number { return (features['elevation_gain'] < 1569 ? -0.0521896482 : 0.0917529389); }
function tree49(features: EventFeaturesComplete): number { return (features['distance_km'] < 15.658 ? (features['distance_km'] < 13.8983002 ? -0.0483812988 : 0.091470778) : -0.0492321923); }
function tree50(features: EventFeaturesComplete): number { return (features['hour_9'] < 0 ? -0.0521236137 : 0.088125512); }
function tree51(features: EventFeaturesComplete): number { return (features['distance_km'] < 10.1412001 ? 0.0824866816 : -0.0517289527); }
function tree52(features: EventFeaturesComplete): number { return (features['is_marathon'] < 1 ? (features['contains_marathon'] < 1 ? -0.0509490184 : 0.0353325717) : (features['distance_km'] < 42.2896996 ? 0.0818633363 : 0.0312798545)); }
function tree53(features: EventFeaturesComplete): number { return (features['month'] < 5 ? 0.0825276896 : (features['is_half_marathon'] < 1 ? (features['month'] < 10 ? (features['pace_min_per_km'] < 5.82973766 ? (features['hour_8'] < 0 ? -0.0468607917 : 0.0100478521) : 0.0159711298) : (features['distance_km'] < 42.4804001 ? 0.0920587331 : -0.0377853662)) : 0.0747137368)); }
function tree54(features: EventFeaturesComplete): number { return (features['elevation_gain'] < 1569 ? -0.0516066626 : 0.0855569616); }
function tree55(features: EventFeaturesComplete): number { return (features['month'] < 8 ? -0.0481444225 : (features['month'] < 9 ? 0.0736723244 : -0.0467304103)); }
function tree56(features: EventFeaturesComplete): number { return (features['hour_9'] < 0 ? -0.0507261232 : 0.0881386027); }
function tree57(features: EventFeaturesComplete): number { return (features['elevation_gain'] < 42 ? 0.0726629943 : -0.0516526401); }
function tree58(features: EventFeaturesComplete): number { return (features['elevation_gain'] < 270 ? -0.0504390709 : (features['day_of_week'] < 6 ? -0.0402655266 : (features['name_length'] < 12 ? 0.0159848835 : 0.101780169))); }
function tree59(features: EventFeaturesComplete): number { return (features['month'] < 5 ? 0.0863259658 : (features['is_half_marathon'] < 1 ? (features['month'] < 10 ? (features['contains_marathon'] < 1 ? (features['elevation_gain'] < 263.899994 ? -0.0468015075 : (features['elevation_gain'] < 329 ? 0.00873667281 : -0.0342362784)) : 0.00061345927) : (features['distance_km'] < 42.4804001 ? 0.092129387 : -0.0417662971)) : 0.0783338398)); }

/**
 * Predict event name from activity features
 */
export function predictEvent(inputFeatures: EventFeatures): EventPrediction {
  // Ensure all one-hot encoded features are present
  const features = {
    ...inputFeatures,
    day_0: inputFeatures.day_0 ?? 0,
    day_1: inputFeatures.day_1 ?? 0,
    day_2: inputFeatures.day_2 ?? 0,
    day_3: inputFeatures.day_3 ?? 0,
    day_4: inputFeatures.day_4 ?? 0,
    day_5: inputFeatures.day_5 ?? 0,
    day_6: inputFeatures.day_6 ?? 0,
    hour_6: inputFeatures.hour_6 ?? 0,
    hour_7: inputFeatures.hour_7 ?? 0,
    hour_8: inputFeatures.hour_8 ?? 0,
    hour_9: inputFeatures.hour_9 ?? 0,
    hour_10: inputFeatures.hour_10 ?? 0,
  };

  // Run all trees and sum predictions for each class
  const numClasses = 6;
  const treesPerClass = 200;
  const rawScores = new Array(numClasses).fill(0);

  // Get predictions from each tree
  const treeFuncs = [
tree0, tree1, tree2, tree3, tree4, tree5, tree6, tree7, tree8, tree9, tree10, tree11, tree12, tree13, tree14, tree15, tree16, tree17, tree18, tree19, tree20, tree21, tree22, tree23, tree24, tree25, tree26, tree27, tree28, tree29, tree30, tree31, tree32, tree33, tree34, tree35, tree36, tree37, tree38, tree39, tree40, tree41, tree42, tree43, tree44, tree45, tree46, tree47, tree48, tree49, tree50, tree51, tree52, tree53, tree54, tree55, tree56, tree57, tree58, tree59
  ];

  for (let i = 0; i < 60; i++) {
    const classIdx = i % numClasses;
    rawScores[classIdx] += treeFuncs[i](features);
  }

  // Apply softmax to get probabilities
  const maxScore = Math.max(...rawScores);
  const expScores = rawScores.map(score => Math.exp(score - maxScore));
  const sumExp = expScores.reduce((a, b) => a + b, 0);
  const probabilities = expScores.map(exp => exp / sumExp);

  // Get top predictions
  const predictions = CLASS_NAMES.map((name, idx) => ({
    event_name: name,
    probability: probabilities[idx],
  })).sort((a, b) => b.probability - a.probability);

  return {
    event_name: predictions[0].event_name,
    probability: predictions[0].probability,
    top_3: predictions.slice(0, 3),
    model: 'xgboost_js_v1',
  };
}
